# 飲食店レコメンドチャットボット概要

## 1. 目的
ユーザーが自然文で入力した希望（例: "渋谷でリーズナブルに焼き鳥が食べたい"）を解析し、Hot Pepper Gourmet API から取得した店舗情報を基に **上位 3 店舗をわかりやすく提案** するチャットボットを提供する。

## 2. 主な技術
- **LangGraph** : ステートフルな対話フローを定義
- **OpenAI GPT‑4o** : クエリ解析と回答生成
- **Hot Pepper Gourmet API** : 飲食店データ取得
- **Pydantic v2** : ステートデータバリデーション

## 3. システムアーキテクチャ
```
ユーザー ─▶ parse_user ─▶ fetch ─▶ answer ──┐
          ▲            ▼          ▲          │
          └───────────◀──────────────┘ (不足情報があれば再ループ)
```
1. **parse_user** : LLM で地名 (`area`) を抽出、足りなければ質問。
2. **fetch** : Hot Pepper API で店舗検索。
3. **answer** : 上位 3 店を要約して返信。質問が残れば `parse_user` へ戻る。

## 4. 代表的なユーザーストーリー
| ID | 役割 | ユーザーストーリー | 受け入れ条件 |
|----|------|------------------|--------------|
| US‑01 | 飲食店を探すユーザー | 「〇〇で美味しいお店を知りたい」ので、候補から行きたい店を素早く選びたい。 | BOT がエリアを認識し、店名・住所・ジャンル・予算・URL を含む上位 3 店を提示する。 |
| US‑02 | 条件が曖昧なユーザー | 「安い居酒屋がいい」と曖昧に尋ねても、必要な情報を聞き返してほしい。 | `area` 不足時に BOT が場所を確認する。 |
| US‑03 | モバイル利用者 | スマホでサクッと検索したい。 | 1 ターン以内に 3 店の概要が 2–3 行で読める。 |
| US‑04 | 開発者 | ジャンルや予算など条件を拡張したい。 | `SearchParams` に項目を追加し、プロンプトと API パラメータを追加するだけで拡張できる。 |
| US‑05 | 運用担当 | API 上限と LLM コストを抑えたい。 | 同一 `area` の短時間再検索をキャッシュする（拡張要件）。 |

## 5. 利用フロー（シーケンス概要）
1. **ユーザー**: 「仙台で美味しいお店」
2. **parse_user**: `area="仙台"` 抽出 → 情報十分と判断
3. **fetch**: Hot Pepper API へ `keyword=仙台` でリクエスト
4. **answer**: 上位 3 店を要約し返信
5. **ユーザー**: 追加質問があれば継続、ない場合終了

## 6. 今後の拡張アイデア
- ジャンル・予算・営業中判定などフィルタ拡張
- 口コミ点数を用いてランキング
- フロントエンドでカード UI（Carousel）表示
- 位置情報（緯度経度）＋徒歩圏フィルタ
- Redis 等でキャッシュしコスト削減
- LangSmith ログ連携（正しい API キー設定時）

---
*Powered by ホットペッパーグルメ Webサービス*

